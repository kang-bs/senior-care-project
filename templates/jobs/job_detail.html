<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ job.title }} - 사람이음</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f8f9fa;
        max-width: 480px;
        margin: 0 auto;
        padding-bottom: 80px;
      }

      /* 헤더 */
      .header {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #333;
      }

      .header-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .action-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #666;
      }

      /* 메인 컨텐츠 */
      .job-detail {
        background: white;
        margin: 20px;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .job-header {
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
        margin-bottom: 20px;
      }

      .company-info {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .company-logo {
        width: 60px;
        height: 60px;
        background: #e9ecef;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #666;
      }

      .company-details h2 {
        font-size: 18px;
        color: #333;
        margin-bottom: 5px;
      }

      .company-name {
        font-size: 14px;
        color: #666;
      }

      .job-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

      .job-meta {
        display: flex;
        gap: 15px;
        font-size: 14px;
        color: #666;
      }

      /* 상세 정보 섹션 */
      .detail-section {
        margin-bottom: 25px;
      }

      .section-title {
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 2px solid #3498db;
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }

      .info-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
      }

      .info-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 14px;
        color: #333;
        font-weight: 500;
      }

      .salary-highlight {
        background: #e8f5e8;
        color: #27ae60;
        font-weight: bold;
        font-size: 18px;
      }

      /* 근무 요일 */
      .work-days {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .day-badge {
        background: #3498db;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }

      .day-badge.inactive {
        background: #e9ecef;
        color: #6c757d;
      }

      /* 설명 */
      .description {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        line-height: 1.6;
        color: #333;
        white-space: pre-wrap;
      }

      /* 통계 정보 */
      .job-stats {
        display: flex;
        justify-content: space-around;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-number {
        font-size: 18px;
        font-weight: bold;
        color: #3498db;
      }

      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      /* 액션 버튼 */
      .action-buttons {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        background: white;
        padding: 15px 20px;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 10px;
      }

      .btn-bookmark {
        background: #f8f9fa;
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-apply {
        flex: 1;
        background: #3498db;
        color: white;
        border: none;
        padding: 15px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
      }

      .btn-apply:hover {
        background: #2980b9;
      }

      /* 작성자 액션 */
      .author-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .btn-edit,
      .btn-delete {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        font-size: 14px;
      }

      .btn-edit {
        background: #f8f9fa;
        color: #333;
      }

      .btn-delete {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .created-date {
        font-size: 12px;
        color: #999;
        text-align: right;
        margin-top: 15px;
      }
    </style>
  </head>
  <body>
    <!-- 헤더 -->
    <div class="header">
      <button class="back-btn" onclick="history.back()">←</button>
      <div class="header-title">공고 상세</div>
      <div class="header-actions">
        <button class="action-btn">⋯</button>
      </div>
    </div>

    <!-- 공고 상세 정보 -->
    <div class="job-detail">
      <!-- 헤더 정보 -->
      <div class="job-header">
        <div class="company-info">
          <div class="company-logo">
            {{ job.company[0] if job.company else '담' }}
          </div>
          <div class="company-details">
            <h2>{{ job.company }}</h2>
            <div class="company-name">담당자</div>
          </div>
        </div>
        <div class="job-title">{{ job.title }}</div>
        <div class="job-meta">
          <span>조회 {{ job.view_count }}</span>
          <span>찜 {{ job.bookmark_count }}</span>
          <span>지원 {{ job.application_count }}</span>
        </div>
      </div>

      <!-- 기본 정보 -->
      <div class="detail-section">
        <div class="section-title">기본 정보</div>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">모집 형태</div>
            <div class="info-value">
              {{ job.recruitment_type or '미정' }} {% if job.recruitment_type ==
              '일용직' and job.work_period %}
              <span
                style="
                  margin-left: 8px;
                  padding: 2px 8px;
                  background: #e8f5e8;
                  color: #27ae60;
                  border-radius: 12px;
                  font-size: 12px;
                "
                >{{ job.work_period }}</span
              >
              {% endif %}
            </div>
          </div>
          <div class="info-item {% if job.salary %}salary-highlight{% endif %}">
            <div class="info-label">급여</div>
            <div class="info-value">{{ job.salary or '협의' }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">모집 인원</div>
            <div class="info-value">
              {{ job.recruitment_count or '미정' }}명
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">근무 지역</div>
            <div class="info-value">{{ job.region or '협의' }}</div>
          </div>
        </div>
      </div>

      <!-- 근무 조건 -->
      <div class="detail-section">
        <div class="section-title">근무 조건</div>

        {% if job.work_start_time or job.work_end_time %}
        <div class="info-item" style="margin-bottom: 15px">
          <div class="info-label">근무 시간</div>
          <div class="info-value">
            {% if job.work_start_time %}{{ job.work_start_time.strftime('%H:%M')
            }}{% else %}시작시간 미정{% endif %} ~ {% if job.work_end_time %}{{
            job.work_end_time.strftime('%H:%M') }}{% else %}종료시간 미정{%
            endif %}
          </div>
        </div>
        {% endif %}

        <div class="info-item">
          <div class="info-label">근무 요일</div>
          <div class="work-days">
            <span
              class="day-badge {% if not job.work_monday %}inactive{% endif %}"
              >월</span
            >
            <span
              class="day-badge {% if not job.work_tuesday %}inactive{% endif %}"
              >화</span
            >
            <span
              class="day-badge {% if not job.work_wednesday %}inactive{% endif %}"
              >수</span
            >
            <span
              class="day-badge {% if not job.work_thursday %}inactive{% endif %}"
              >목</span
            >
            <span
              class="day-badge {% if not job.work_friday %}inactive{% endif %}"
              >금</span
            >
            <span
              class="day-badge {% if not job.work_saturday %}inactive{% endif %}"
              >토</span
            >
            <span
              class="day-badge {% if not job.work_sunday %}inactive{% endif %}"
              >일</span
            >
          </div>
        </div>
      </div>

      <!-- 상세 설명 -->
      <div class="detail-section">
        <div class="section-title">상세 설명</div>
        <div class="description">{{ job.description }}</div>
      </div>

      <!-- 연락처 -->
      {% if job.contact_phone %}
      <div class="detail-section">
        <div class="section-title">연락처</div>
        <div class="info-item">
          <div class="info-label">전화번호</div>
          <div class="info-value">{{ job.contact_phone }}</div>
        </div>
      </div>
      {% endif %}

      <!-- 통계 -->
      <div class="job-stats">
        <div class="stat-item">
          <div class="stat-number">{{ job.view_count }}</div>
          <div class="stat-label">조회수</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ job.bookmark_count }}</div>
          <div class="stat-label">찜</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ job.application_count }}</div>
          <div class="stat-label">지원</div>
        </div>
      </div>

      <!-- 작성자 전용 액션 -->
      {% if current_user.id == job.author_id %}
      <div class="author-actions">
        <a href="{{ url_for('jobs.edit_job', job_id=job.id) }}" class="btn-edit"
          >수정하기</a
        >
        <form
          method="POST"
          action="{{ url_for('jobs.delete_job', job_id=job.id) }}"
          style="flex: 1"
          onsubmit="return confirm('정말 삭제하시겠습니까?')"
        >
          <button
            type="submit"
            class="btn-delete"
            style="width: 100%; border: none"
          >
            삭제하기
          </button>
        </form>
      </div>
      {% endif %}

      <div class="created-date">
        {{ job.created_at.strftime('%Y년 %m월 %d일 %H:%M') }} 등록
      </div>
    </div>

    <!-- 액션 버튼 (작성자가 아닌 경우만) -->
    {% if current_user.id != job.author_id %}
    <div class="action-buttons">
      <button
        class="btn-bookmark"
        onclick="toggleBookmark()"
        style="color: {% if is_bookmarked %}#e74c3c{% else %}#666{% endif %};"
      >
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          />
        </svg>
      </button>
      <button class="btn-apply" onclick="applyJob()">지원하기</button>
    </div>
    {% endif %}

    <script>
      function toggleBookmark() {
        const bookmarkBtn = document.querySelector('.btn-bookmark');
        const jobId = {{ job.id }};

        fetch(`/jobs/${jobId}/bookmark`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            const heartIcon = bookmarkBtn.querySelector('svg path');
            if (data.is_bookmarked) {
              bookmarkBtn.style.color = '#e74c3c';
            } else {
              bookmarkBtn.style.color = '#666';
            }

            // 통계 업데이트
            const bookmarkStat = document.querySelector('.stat-item:nth-child(2) .stat-number');
            if (bookmarkStat) {
              bookmarkStat.textContent = data.bookmark_count;
            }
          } else {
            alert(data.message || '오류가 발생했습니다.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('오류가 발생했습니다.');
        });
      }

      function applyJob() {
        if (confirm("이 공고에 지원하시겠습니까?")) {
          alert("지원이 완료되었습니다!");
          // 실제로는 서버에 지원 요청을 보내야 함
        }
      }
    </script>

    <!-- 하단 네비게이션 (작성자인 경우에만 표시) -->
    {% if current_user.id == job.author_id %}
    <div
      style="
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        background: white;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        z-index: 999;
      "
    >
      <a
        href="#"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: #666;
          text-decoration: none;
          font-size: 12px;
          transition: color 0.3s;
        "
      >
        <svg
          style="width: 24px; height: 24px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <span>찾기</span>
      </a>
      <a
        href="{{ url_for('jobs.bookmark_list') }}"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: #666;
          text-decoration: none;
          font-size: 12px;
          transition: color 0.3s;
        "
      >
        <svg
          style="width: 24px; height: 24px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          />
        </svg>
        <span>찜</span>
      </a>
      <a
        href="{{ url_for('auth.main') }}"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: #666;
          text-decoration: none;
          font-size: 12px;
          transition: color 0.3s;
        "
      >
        <svg
          style="width: 24px; height: 24px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
        </svg>
        <span>홈</span>
      </a>
      <a
        href="#"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: #666;
          text-decoration: none;
          font-size: 12px;
          transition: color 0.3s;
        "
      >
        <svg
          style="width: 24px; height: 24px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"
          />
        </svg>
        <span>채팅</span>
      </a>
      <a
        href="{{ url_for('auth.profile') }}"
        style="
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 4px;
          color: #666;
          text-decoration: none;
          font-size: 12px;
          transition: color 0.3s;
        "
      >
        <svg
          style="width: 24px; height: 24px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
          />
        </svg>
        <span>내정보</span>
      </a>
    </div>
    {% endif %}
  </body>
</html>
