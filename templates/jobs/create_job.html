<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>공고 작성 - 사람이음</title>
    <script src="https://cdn.tailwindcss.com"></script>
      <script src="//dapi.kakao.com/v2/maps/sdk.js?appkey={{ kakao_key }}&libraries=services"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* 사용자 정의 폰트 및 스타일 */
      body {
        font-family: "Noto Sans KR", sans-serif;
      }
      .btn-option.active {
        border-color: #2563eb;
        background-color: #2563eb;
        color: white;
      }
       /* --- 모달 및 지도 스타일 (수정됨) --- */
      #addressModal {
        display: none; /* 평소에는 숨김 */
        position: fixed;
        inset: 0; /* top, right, bottom, left: 0 */
        background-color: rgba(0, 0, 0, 0.6); /* 반투명 배경 */
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }
      #addressModal .modal-card {
        width: 90vw;
        max-width: 500px;
        background: #fff;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      /* 지도 컨테이너 크기 지정 (필수) */
      #addressMap {
        width: 100%;
        height: 400px;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <div class="max-w-sm mx-auto bg-white shadow-lg min-h-screen">
      <!-- 상단 바 -->
      <header
        class="sticky top-0 z-10 p-4 flex justify-between items-center bg-white shadow-sm"
      >
        <button class="p-2" onclick="history.back()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M15 19l-7-7 7-7"
            />
          </svg>
        </button>
        <h1 class="text-xl font-bold text-gray-800">공고 작성</h1>
        <div class="flex items-center gap-2">
          <a href="{{ url_for('job_assistant.general_job_assistant_page') }}" 
             class="p-2 text-green-600 hover:text-green-800" 
             title="AI 도우미">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
            </svg>
          </a>
          <button
            class="text-blue-600 font-bold p-2"
            onclick="document.getElementById('jobForm').submit()"
        >
          저장
        </button>
        </div>
      </header>

      <!-- 메인 컨텐츠 -->
      <main class="p-4 bg-white pb-24">
        <form id="jobForm" method="POST" class="space-y-6">
          <!-- 기본 정보 -->
          <div>
            <label for="title" class="block text-sm font-medium text-gray-700"
              >제목 <span class="text-red-500">*</span></label
            >
            <input
              type="text"
              name="title"
              id="title"
              class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="공고 제목을 입력하세요"
              required
            />
          </div>

          <div>
            <label for="company" class="block text-sm font-medium text-gray-700"
              >담당자명 <span class="text-red-500">*</span></label
            >
            <input
              type="text"
              name="company"
              id="company"
              class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="담당자명을 입력하세요"
              required
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >모집 형태 <span class="text-red-500">*</span></label
            >
            <div class="mt-2 grid grid-cols-2 gap-3">
              <button
                type="button"
                class="btn-option w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                data-value="정규직"
                onclick="selectRecruitmentType(this, '정규직')"
              >
                정규직
              </button>
              <button
                type="button"
                class="btn-option w-full py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50"
                data-value="일용직"
                onclick="selectRecruitmentType(this, '일용직')"
              >
                일용직
              </button>
            </div>
            <input
              type="hidden"
              name="recruitment_type"
              id="recruitment_type"
              required
            />
          </div>

          <div id="work_period_group" style="display: none">
            <label class="block text-sm font-medium text-gray-700"
              >근무 기간 <span class="text-red-500">*</span></label
            >
            <div class="mt-2 grid grid-cols-3 gap-3">
              <button
                type="button"
                class="btn-option w-full py-2 px-2 border border-gray-300 rounded-md shadow-sm text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                data-value="1개월 이상"
                onclick="selectWorkPeriod(this, '1개월 이상')"
              >
                1개월 이상
              </button>
              <button
                type="button"
                class="btn-option w-full py-2 px-2 border border-gray-300 rounded-md shadow-sm text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                data-value="3개월 이상"
                onclick="selectWorkPeriod(this, '3개월 이상')"
              >
                3개월 이상
              </button>
              <button
                type="button"
                class="btn-option w-full py-2 px-2 border border-gray-300 rounded-md shadow-sm text-xs font-medium text-gray-700 bg-white hover:bg-gray-50"
                data-value="6개월 이상"
                onclick="selectWorkPeriod(this, '6개월 이상')"
              >
                6개월 이상
              </button>
            </div>
            <input type="hidden" name="work_period" id="work_period" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >근무 요일</label
            >
            <div class="mt-2 flex flex-wrap gap-4">
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="monday"
                  name="work_monday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="monday" class="ml-2 block text-sm text-gray-900"
                  >월</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="tuesday"
                  name="work_tuesday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="tuesday" class="ml-2 block text-sm text-gray-900"
                  >화</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="wednesday"
                  name="work_wednesday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label
                  for="wednesday"
                  class="ml-2 block text-sm text-gray-900"
                  >수</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="thursday"
                  name="work_thursday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="thursday" class="ml-2 block text-sm text-gray-900"
                  >목</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="friday"
                  name="work_friday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="friday" class="ml-2 block text-sm text-gray-900"
                  >금</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="saturday"
                  name="work_saturday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="saturday" class="ml-2 block text-sm text-gray-900"
                  >토</label
                >
              </div>
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="sunday"
                  name="work_sunday"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                /><label for="sunday" class="ml-2 block text-sm text-gray-900"
                  >일</label
                >
              </div>
            </div>
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700"
              >근무 시간</label
            >
            <div class="mt-1 flex items-center gap-2">
              <input
                type="time"
                name="work_start_time"
                class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              />
              <span>~</span>
              <input
                type="time"
                name="work_end_time"
                class="block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              />
            </div>
          </div>

            <div>
                <label for="salary" class="block text-sm font-medium text-gray-700"
                >급여</label
                >
                <input
                        type="text"
                        name="salary"
                        id="salary"
                        class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
                        placeholder="예: 시급 10,000원"
                />
            </div>

            <!-- 근무 지역 -->
            <div>
                <label for="region" class="block text-sm font-medium text-gray-700">근무 지역 <span
                        class="text-red-500">*</span></label>
                <div class="flex items-center gap-2">
                    <input type="text" name="region" id="region" readonly
                           class="mt-1 block w-full bg-gray-100 rounded-md border border-gray-300 shadow-sm"
                           placeholder="주소 검색 버튼으로 선택" required/>
                    <button type="button" onclick="openAddressModal()"
                            class="py-2 px-4 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700 whitespace-nowrap">
                        주소 검색
                    </button>
                </div>
            </div>


            <!-- 숨은 위도, 경도 필드 -->
            <input type="hidden" id="latitude" name="latitude"/>
            <input type="hidden" id="longitude" name="longitude"/>

            <input type="hidden" id="region_1depth_name" name="region_1depth_name"/>
            <input type="hidden" id="region_2depth_name" name="region_2depth_name"/>
            <input type="hidden" id="region_3depth_name" name="region_3depth_name"/>

            <!-- 주소 선택 모달 -->
            <div id="addressModal">
                <div class="modal-card">
                    <!-- 검색 UI 추가 -->
                    <div class="p-3 border-b">
                        <div class="flex gap-2">
                            <input type="text" id="addressSearchKeyword" class="flex-grow border rounded px-2 py-1"
                                   placeholder="주소나 장소명을 입력하세요">
                            <button onclick="searchAddress()" class="bg-gray-200 px-3 rounded">검색</button>
                        </div>
                    </div>
                    <div id="addressMap"></div>
                    <div class="flex justify-end p-3 border-t border-gray-200">
                        <button onclick="selectAddress()"
                                class="bg-blue-600 hover:bg-blue-700 text-white py-1 px-3 rounded-md text-sm mr-2">이 위치로
                            선택
                        </button>
                        <button onclick="closeAddressModal()"
                                class="bg-gray-500 hover:bg-gray-600 text-white py-1 px-3 rounded-md text-sm">닫기
                        </button>
                    </div>
                </div>
            </div>

            <div>
                <label
                        for="recruitment_count"
                        class="block text-sm font-medium text-gray-700"
              >모집 인원</label
            >
            <input
              type="number"
              name="recruitment_count"
              id="recruitment_count"
              class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="모집 인원 수"
              min="1"
            />
          </div>

          <div>
            <label
              for="contact_phone"
              class="block text-sm font-medium text-gray-700"
              >연락처</label
            >
            <input
              type="tel"
              name="contact_phone"
              id="contact_phone"
              class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="연락 가능한 전화번호"
            />
          </div>

          <div>
            <div class="flex justify-between items-center">
              <label
                for="description"
                class="block text-sm font-medium text-gray-700"
                >상세 설명 <span class="text-red-500">*</span></label
              >
              <button type="button" onclick="openAIAssistant()" 
                      class="text-xs text-green-600 hover:text-green-800 flex items-center gap-1 bg-transparent border-none cursor-pointer font-semibold">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                </svg>
                AI 도우미
              </button>
            </div>
            <textarea
              name="description"
              id="description"
              rows="4"
              class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
              placeholder="업무 내용, 자격 요건 등을 자세히 작성해주세요&#10;&#10;AI 도우미를 사용하면 전문적인 공고를 쉽게 작성할 수 있습니다."
              required
            ></textarea>
          </div>


          <div class="flex gap-4 pt-4">
            <button
              type="button"
              class="flex-1 w-full justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-500 hover:bg-gray-600"
              onclick="history.back()"
            >
              취소
            </button>
            <button
              type="submit"
              class="flex-1 w-full justify-center py-3 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-800 hover:bg-blue-900"
            >
              등록하기
            </button>
          </div>
        </form>
      </main>

      <!-- 하단 네비게이션 -->
      <footer
        class="fixed bottom-0 left-0 right-0 max-w-sm mx-auto bg-gray-50 border-t flex justify-around"
      >
        <a
          href="{{ url_for('map.show_map') }}"
          class="flex-1 flex flex-col items-center justify-center p-2 text-gray-500"
        >
          <div class="w-6 h-6 mb-1 flex items-center justify-center">
            <img
              src="{{ url_for('static', filename='images/footer/map.png') }}"
              alt="지도"
              class="max-w-full max-h-full object-contain"
            />
          </div>
          <span class="text-xs">지도</span>
        </a>
        <a
          href="{{ url_for('jobs.bookmark_list') }}"
          class="flex-1 flex flex-col items-center justify-center p-2 text-gray-500"
        >
          <div class="w-6 h-6 mb-1 flex items-center justify-center">
            <img
              src="{{ url_for('static', filename='images/footer/favorite.png') }}"
              alt="찜"
              class="max-w-full max-h-full object-contain"
            />
          </div>
          <span class="text-xs">찜</span>
        </a>
        <a
          href="{{ url_for('auth.main') }}"
          class="flex-1 flex flex-col items-center justify-center p-2 text-gray-500"
        >
          <div class="w-6 h-6 mb-1 flex items-center justify-center">
            <img
              src="{{ url_for('static', filename='images/footer/home.png') }}"
              alt="홈"
              class="max-w-full max-h-full object-contain"
            />
          </div>
          <span class="text-xs">홈</span>
        </a>
        <a
          href="{{ url_for('chat.chat_list') }}"
          class="flex-1 flex flex-col items-center justify-center p-2 text-gray-500"
        >
          <div class="w-6 h-6 mb-1 flex items-center justify-center">
            <img
              src="{{ url_for('static', filename='images/footer/chatting.png') }}"
              alt="채팅"
              class="max-w-full max-h-full object-contain"
            />
          </div>
          <span class="text-xs">채팅</span>
        </a>
        <a
          href="{{ url_for('auth.profile') }}"
          class="flex-1 flex flex-col items-center justify-center p-2 text-gray-500"
        >
          <div class="w-6 h-6 mb-1 flex items-center justify-center">
            <img
              src="{{ url_for('static', filename='images/footer/profile.png') }}"
              alt="내정보"
              class="max-w-full max-h-full object-contain"
            />
          </div>
          <span class="text-xs">내정보</span>
        </a>
      </footer>
    </div>

    <script>
      function selectRecruitmentType(button, value) {
        document
          .querySelectorAll(".btn-option[data-value]")
          .forEach((btn) => btn.classList.remove("active"));
        button.classList.add("active");
        document.getElementById("recruitment_type").value = value;

        const workPeriodGroup = document.getElementById("work_period_group");
        if (value === "일용직") {
          workPeriodGroup.style.display = "block";
          document.getElementById("work_period").required = true;
        } else {
          workPeriodGroup.style.display = "none";
          document.getElementById("work_period").required = false;
          document.getElementById("work_period").value = "";
          document
            .querySelectorAll("#work_period_group .btn-option")
            .forEach((btn) => btn.classList.remove("active"));
        }
      }

      // 모달/지도 상태
      var addressModal = document.getElementById("addressModal");
      var addressMap, addressMarker, selectedPosition;
      var geocoder = new kakao.maps.services.Geocoder();
      var ps = new kakao.maps.services.Places();

      // 주소로 검색하는 함수
      function searchAddress() {
          var keyword = document.getElementById('addressSearchKeyword').value;

          if (!keyword.replace(/^\s*|\s*$/g, '')) {
              alert('키워드를 입력해주세요!');
              return false;
          }

          // 장소검색 객체를 통해 키워드로 장소검색을 요청합니다
          ps.keywordSearch(keyword, function (data, status, pagination) {
              if (status === kakao.maps.services.Status.OK) {
                  // 검색된 장소 위치를 기준으로 지도 범위를 재설정합니다
                  var bounds = new kakao.maps.LatLngBounds();

                  for (var i = 0; i < data.length; i++) {
                      bounds.extend(new kakao.maps.LatLng(data[i].y, data[i].x));
                  }

                   addressMap.setBounds(bounds);

                  // 첫 번째 검색 결과의 위치로 마커와 중심 좌표를 설정합니다.
                  if (data.length > 0) {
                      var firstItem = data[0];
                      var moveLatLon = new kakao.maps.LatLng(firstItem.y, firstItem.x);

                      addressMap.setCenter(moveLatLon);
                      addressMarker.setPosition(moveLatLon);
                      selectedPosition = moveLatLon;
                  }
              } else if (status === kakao.maps.services.Status.ZERO_RESULT) {
                  alert('검색 결과가 존재하지 않습니다.');
                  return;
              } else if (status === kakao.maps.services.Status.ERROR) {
                  alert('검색 결과 중 오류가 발생했습니다.');
                  return;
              }
          });
      }

      // 지도 최초 1회 생성
      function initAddressMapOnce() {
          if (addressMap) return;
          var mapContainer = document.getElementById("addressMap");
          var mapOption = {
              center: new kakao.maps.LatLng(37.566826, 126.9786567),
              level: 3,
          };
          addressMap = new kakao.maps.Map(mapContainer, mapOption);

          addressMarker = new kakao.maps.Marker({
              position: addressMap.getCenter(),
              map: addressMap,
          });
          selectedPosition = addressMap.getCenter();

          // 지도 클릭 -> 좌표 선택 및 마커 이동
          kakao.maps.event.addListener(addressMap, "click", function (mouseEvent) {
              var latlng = mouseEvent.latLng;
              addressMarker.setPosition(latlng);
              selectedPosition = latlng;
          });
      }

      // 모달 열기 -> 다음 프레임에 relayout + setCenter
      function openAddressModal() {
          addressModal.style.display = "flex";
          initAddressMapOnce();
          requestAnimationFrame(function () {
              addressMap.relayout();
              addressMap.setCenter(selectedPosition);
          });
      }

      // 선택 완료: 좌표->주소 변환 후 폼 반영 (수정됨)
      async function selectAddress() {
          if (!selectedPosition) {
              alert("지도에서 위치를 먼저 클릭해주세요.");
              return;
          }

          const lat = selectedPosition.getLat();
          const lng = selectedPosition.getLng();

          document.getElementById("latitude").value = lat;
          document.getElementById("longitude").value = lng;

          try {
              const getAddress = new Promise((resolve, reject) => {
                  geocoder.coord2Address(lng, lat, (result, status) => {
                      (status === kakao.maps.services.Status.OK) ? resolve(result) : reject(new Error("주소 변환 실패"));
                  });
              });

              const getRegion = new Promise((resolve, reject) => {
                  geocoder.coord2RegionCode(lng, lat, (result, status) => {
                      (status === kakao.maps.services.Status.OK) ? resolve(result) : reject(new Error("지역 코드 변환 실패"));
                  });
              });

              const [addrResult, regionResult] = await Promise.all([getAddress, getRegion]);

              // 도로명/지번 주소 설정 (화면 표시용)
              const roadAddr = addrResult[0].road_address?.address_name || "";
              const jibunAddr = addrResult[0].address?.address_name || "";
              document.getElementById("region").value = roadAddr || jibunAddr;

              // [핵심 수정] 법정동(B) 정보 설정 (DB 저장 및 필터링용)
              const legalRegion = regionResult.find(r => r.region_type === 'B') || regionResult[0]; // 'H' -> 'B'로 변경

              // 필드명도 b_ 로 변경하여 법정동임을 명시하는 것을 권장
              document.getElementById('region_1depth_name').value = legalRegion.region_1depth_name;
              document.getElementById('region_2depth_name').value = legalRegion.region_2depth_name;
              document.getElementById('region_3depth_name').value = legalRegion.region_3depth_name;

          } catch (error) {
              console.error("주소 변환 중 오류 발생:", error);
              alert("주소 정보를 가져오는 데 실패했습니다.");
          } finally {
              closeAddressModal();
          }
      }

      function closeAddressModal() {
          addressModal.style.display = "none";
      }

      function selectWorkPeriod(button, value) {
          document
              .querySelectorAll("#work_period_group .btn-option")
              .forEach((btn) => btn.classList.remove("active"));
          button.classList.add("active");
          document.getElementById("work_period").value = value;
      }

      document
        .getElementById("jobForm")
        .addEventListener("submit", function (e) {
          const recruitmentType =
            document.getElementById("recruitment_type").value;
          const workPeriod = document.getElementById("work_period").value;

          if (!recruitmentType) {
            alert("모집 형태를 선택해주세요.");
            e.preventDefault();
            return;
          }

          if (recruitmentType === "일용직" && !workPeriod) {
            alert("근무 기간을 선택해주세요.");
            e.preventDefault();
            return;
          }
        });
    </script>

    <!-- AI 도우미 모달 -->
    <div id="aiAssistantModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
      <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg max-w-md w-full max-h-screen overflow-y-auto">
          <div class="p-4 border-b">
            <div class="flex justify-between items-center">
              <h3 class="text-lg font-bold text-gray-800">AI 상세 설명 생성</h3>
              <button onclick="closeAIAssistant()" class="text-gray-500 hover:text-gray-700">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
              </button>
            </div>
          </div>
          
          <div class="p-4">
            <div class="mb-4 p-3 bg-green-50 rounded-lg border border-green-200">
              <p class="text-sm text-green-800">
                <strong>AI 도우미가 전문적인 공고를 작성해드립니다</strong><br>
                • 업무별 맞춤 표현 자동 생성<br>
                • 깔끔하고 이해하기 쉬운 문체 적용<br>
                • 구조화된 상세 설명<br>
                • 모든 필수 정보가 포함된 완성도 높은 공고
              </p>
            </div>

            <!-- 추가 정보 입력 폼 -->
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">주요 업무 (구체적으로)</label>
                <textarea id="aiDuties" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" 
                          placeholder="예: 고객 주문 받기, 음료 제조, 매장 청소"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">어떤 분을 찾나요?</label>
                <textarea id="aiRequirements" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" 
                          placeholder="예: 친절하신 분, 책임감 있으신 분"></textarea>
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">혜택 / 좋은 점</label>
                <textarea id="aiBenefits" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm" 
                          placeholder="예: 식사 제공, 교통비 지원, 자유로운 분위기"></textarea>
              </div>

              <!-- 추가 옵션 -->
              <div class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                <h4 class="text-sm font-medium text-gray-800 mb-2">추가 옵션</h4>
                <div class="space-y-2">
                  <label class="flex items-center">
                    <input type="checkbox" id="aiTrainingProvided" class="mr-2">
                    <span class="text-sm">교육 제공</span>
                  </label>
                  <label class="flex items-center">
                    <input type="checkbox" id="aiFlexibleTime" class="mr-2">
                    <span class="text-sm">시간 조정 가능</span>
                  </label>
                </div>
              </div>
            </div>

            <!-- 버튼 -->
            <div class="flex gap-2 mt-6">
              <button onclick="closeAIAssistant()" 
                      class="flex-1 px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50">
                취소
              </button>
              <button onclick="generateAIDescription()" 
                      class="flex-1 px-4 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 font-semibold">
                <span id="generateBtnText">AI로 상세 설명 생성하기</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // AI 도우미 모달 열기
      function openAIAssistant() {
        // 기본 폼 데이터 검증
        const title = document.querySelector('input[name="title"]').value.trim();
        const company = document.querySelector('input[name="company"]').value.trim();
        
        if (!title) {
          alert('제목을 먼저 입력해주세요.');
          return;
        }
        
        if (!company) {
          alert('담당자명을 먼저 입력해주세요.');
          return;
        }
        
        document.getElementById('aiAssistantModal').classList.remove('hidden');
      }

      // AI 도우미 모달 닫기
      function closeAIAssistant() {
        document.getElementById('aiAssistantModal').classList.add('hidden');
      }

      // AI 상세 설명 생성
      async function generateAIDescription() {
        const generateBtn = document.getElementById('generateBtnText');
        generateBtn.innerHTML = 'AI가 작성 중입니다...';
        
        try {
          // 기본 폼 데이터 수집
          const formData = collectFormData();
          
          // 추가 정보 수집
          formData.duties = document.getElementById('aiDuties').value.trim() || '업무 내용을 입력해주세요';
          formData.requirements = document.getElementById('aiRequirements').value.trim();
          formData.benefits = document.getElementById('aiBenefits').value.trim();
          formData.training_provided = document.getElementById('aiTrainingProvided').checked;
          formData.flexible_time = document.getElementById('aiFlexibleTime').checked;
          formData.job_type = 'general';

          // 디버깅: 수집된 데이터 확인
          console.log('수집된 폼 데이터:', formData);

          const response = await fetch('/api/job-draft', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
          });

          const result = await response.json();

          if (result.success) {
            // 생성된 설명을 textarea에 입력
            const descriptionTextarea = document.getElementById('description');
            descriptionTextarea.value = result.content.description;
            
            // 모달 닫기
            closeAIAssistant();
            
            // 성공 메시지
            alert('AI가 전문적인 상세 설명을 생성했습니다.\n구조화된 내용을 확인하고 필요시 수정해주세요.');
          } else {
            alert('생성 실패: ' + result.error);
          }
        } catch (error) {
          alert('서버 오류: ' + error.message);
        } finally {
          generateBtn.innerHTML = 'AI로 상세 설명 생성하기';
        }
      }

      // 폼 데이터 수집 함수
      function collectFormData() {
        const formData = {
          title: document.querySelector('input[name="title"]').value.trim() || '일자리 공고',
          company: document.querySelector('input[name="company"]').value.trim() || '회사명',
          location: document.querySelector('input[name="region"]').value.trim() || '서울',
        };

        // 모집 형태
        const recruitmentTypeBtn = document.querySelector('.btn-option.active[data-value]');
        if (recruitmentTypeBtn) {
          formData.employment_type = recruitmentTypeBtn.getAttribute('data-value');
        } else {
          // 선택된 버튼이 없으면 기본값 설정
          formData.employment_type = '정규직';
        }

        // 근무 요일
        const workDays = [];
        const dayCheckboxes = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
        const dayNames = ['월', '화', '수', '목', '금', '토', '일'];
        
        dayCheckboxes.forEach((day, index) => {
          const checkbox = document.querySelector(`input[name="work_${day}"]`);
          if (checkbox && checkbox.checked) {
            workDays.push(dayNames[index]);
          }
        });
        
        if (workDays.length > 0) {
          formData.work_days = workDays.join('');
        }

        // 근무 시간
        const startTime = document.querySelector('input[name="work_start_time"]').value;
        const endTime = document.querySelector('input[name="work_end_time"]').value;
        if (startTime && endTime) {
          formData.work_time = `${startTime}~${endTime}`;
        }

        // 급여
        const salary = document.querySelector('input[name="salary"]').value.trim();
        if (salary) {
          formData.salary = salary;
        }

        // 모집 인원
        const recruitmentCount = document.querySelector('input[name="recruitment_count"]').value.trim();
        if (recruitmentCount) {
          formData.recruitment_count = recruitmentCount;
        }

        // 연락처
        const contact = document.querySelector('input[name="contact_phone"]').value.trim();
        if (contact) {
          formData.contact_phone = contact;
        }

        return formData;
      }

      // 모달 외부 클릭 시 닫기
      document.getElementById('aiAssistantModal').addEventListener('click', function(e) {
        if (e.target === this) {
          closeAIAssistant();
        }
      });
    </script>
  </body>
</html>
