<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ì‚¬ëŒì´ìŒ - êµ¬ì¸ê³µê³ </title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f8f9fa;
        padding-bottom: 80px;
        max-width: 480px;
        margin: 0 auto;
        position: relative;
      }

      /* ìƒë‹¨ í—¤ë” */
      .header {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .logo-text {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
      }

      .header-icons {
        display: flex;
        gap: 15px;
      }

      .icon-btn {
        width: 24px;
        height: 24px;
        cursor: pointer;
        color: #666;
      }

      /* íƒ­ ë©”ë‰´ */
      .tab-menu {
        background: white;
        padding: 15px 20px 0;
        display: flex;
        gap: 30px;
      }

      .tab-item {
        padding: 10px 0;
        color: #666;
        font-size: 16px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.3s;
        text-decoration: none;
      }

      .tab-item.active {
        color: #2c3e50;
        border-bottom-color: #3498db;
        font-weight: 600;
      }

      /* ì§€ì—­ ì„ íƒ */
      .location-selector {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #3498db;
        font-size: 14px;
      }

      .location-icon {
        width: 16px;
        height: 16px;
      }

      .sort-btn {
        background: #f0f0f0;
        border: 1px solid #ddd;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
        margin-left: auto;
        cursor: pointer;
        position: relative;
      }

      .sort-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 100;
        min-width: 120px;
        display: none;
      }

      .sort-dropdown.show {
        display: block;
      }

      .sort-option {
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
        border-bottom: 1px solid #eee;
        transition: background 0.2s;
      }

      .sort-option:last-child {
        border-bottom: none;
      }

      .sort-option:hover {
        background: #f8f9fa;
      }

      .sort-option.active {
        background: #3498db;
        color: white;
      }

      /* ê¸€ì“°ê¸° ë²„íŠ¼ */
      .write-section {
        background: #3498db;
        padding: 20px;
        margin: 0 20px;
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
      }

      .write-section:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
      }

      .write-text {
        font-size: 18px;
        font-weight: 600;
        color: white;
        margin-right: 10px;
      }

      .write-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
      }

      .write-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* ê³µê³  ë¦¬ìŠ¤íŠ¸ */
      .job-list {
        padding: 20px;
      }

      .job-card {
        background: white;
        margin: 0 20px 15px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
        cursor: pointer;
        transition: transform 0.2s;
        position: relative;
      }

      .job-card:hover {
        transform: translateY(-2px);
      }

      .job-image {
        width: 80px;
        height: 80px;
        background: #ddd;
        border-radius: 8px;
        flex-shrink: 0;
      }

      .job-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .company-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .company-logo {
        width: 40px;
        height: 40px;
        background: #e9ecef;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: #666;
      }

      .company-details h3 {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 2px;
      }

      .deadline {
        font-size: 12px;
        color: #e74c3c;
      }

      .job-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
      }

      .job-salary {
        font-size: 16px;
        color: #27ae60;
        font-weight: 600;
        margin-bottom: 12px;
      }

      .job-tags {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
      }

      .tag {
        background: #f8f9fa;
        color: #666;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }

      .apply-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: background 0.3s;
      }

      .apply-btn:hover {
        background: #2980b9;
      }

      .job-stats {
        font-size: 12px;
        color: #666;
      }

      /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        background: white;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        z-index: 1000;
      }

      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: #666;
        text-decoration: none;
        font-size: 12px;
        transition: color 0.3s;
      }

      .nav-item.active {
        color: #3498db;
      }

      .nav-icon {
        width: 24px;
        height: 24px;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
      }

      .empty-state h3 {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="header">
      <div class="logo">
        <div class="logo-icon">ğŸ˜Š</div>
        <div class="logo-text">ì´ìŒ</div>
      </div>
      <div class="header-icons">
        <svg class="icon-btn" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
          />
          <path
            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
          />
        </svg>
        <svg class="icon-btn" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
      </div>
    </div>

    <!-- íƒ­ ë©”ë‰´ -->
    <div class="tab-menu">
      <a href="{{ url_for('auth.main') }}" class="tab-item">ë‚˜ì˜ ì´ìŒ</a>
      <a href="#" class="tab-item">ê¸°ì—… ì´ìŒ</a>
      <a href="{{ url_for('jobs.job_list') }}" class="tab-item active"
        >ì‚¬ëŒ ì´ìŒ</a
      >
    </div>

    <!-- ì§€ì—­ ì„ íƒ -->
    <div class="location-selector">
      <svg class="location-icon" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
        />
      </svg>
      <span>ê²½ìƒì‹œ ì¡°ì˜ë™</span>
      <svg
        style="width: 12px; height: 12px"
        fill="currentColor"
        viewBox="0 0 24 24"
      >
        <path d="M7 10l5 5 5-5z" />
      </svg>
      <div class="sort-btn" onclick="toggleSortDropdown()">
        {% if current_sort == 'latest' %}ìµœì‹ ìˆœ {% elif current_sort ==
        'popular' %}ì¸ê¸°ìˆœ {% elif current_sort == 'views' %}ì¡°íšŒìˆœ {% else
        %}ìµœì‹ ìˆœ{% endif %}
        <svg
          style="width: 12px; height: 12px; margin-left: 5px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path d="M7 10l5 5 5-5z" />
        </svg>
        <div class="sort-dropdown" id="sortDropdown">
          <div
            class="sort-option {% if current_sort == 'latest' %}active{% endif %}"
            onclick="changeSortOrder('latest')"
          >
            ìµœì‹ ìˆœ
          </div>
          <div
            class="sort-option {% if current_sort == 'popular' %}active{% endif %}"
            onclick="changeSortOrder('popular')"
          >
            ì¸ê¸°ìˆœ
          </div>
          <div
            class="sort-option {% if current_sort == 'views' %}active{% endif %}"
            onclick="changeSortOrder('views')"
          >
            ì¡°íšŒìˆœ
          </div>
        </div>
      </div>
    </div>

    <!-- ê¸€ì“°ê¸° ì„¹ì…˜ -->
    <div
      class="write-section"
      onclick="location.href='{{ url_for('jobs.create_job') }}'"
    >
      <div class="write-text">ì¼ìë¦¬ ê³µê³  ì‘ì„±í•˜ê¸°</div>
      <button class="write-btn">+</button>
    </div>

    <!-- ê³µê³  ë¦¬ìŠ¤íŠ¸ -->
    <div class="job-list">
      {% if jobs_with_status %} {% for job_data in jobs_with_status %} {% set
      job = job_data.job %} {% set status = job_data.application_status %}
      <div
        class="job-card"
        onclick="location.href='{{ url_for('jobs.job_detail', job_id=job.id) }}'"
      >
        <div class="job-header">
          <div class="company-info">
            <div class="company-logo">
              {{ job.company[0] if job.company else 'ë‹´' }}
            </div>
            <div class="company-details">
              <h3>{{ job.company }} ë‹´ë‹¹ì</h3>
            </div>
          </div>
        </div>
        <div class="job-title">{{ job.title }}</div>
        <div class="job-salary">
          {% if job.salary %}{{ job.salary }}{% else %}ê¸‰ì—¬ í˜‘ì˜{% endif %}
        </div>
        <div class="job-tags">
          {% if job.recruitment_type %}<span class="tag"
            >{{ job.recruitment_type }}</span
          >{% endif %} {% if job.work_period %}<span class="tag"
            >{{ job.work_period }}</span
          >{% endif %}
        </div>

        {% if current_user.id == job.author_id %}
        <!-- ë³¸ì¸ì´ ì‘ì„±í•œ ê³µê³ ì¸ ê²½ìš° -->
        <button
          class="apply-btn"
          style="background: #6c757d; cursor: not-allowed"
          disabled
        >
          ë‚´ê°€ ì‘ì„±í•œ ê³µê³ 
        </button>
        {% elif status.applied %}
        <!-- ì´ë¯¸ ì§€ì›í•œ ê³µê³ ì¸ ê²½ìš° -->
        <button
          class="apply-btn"
          style="background: #28a745"
          onclick="event.stopPropagation(); goToChat({{ job.id }})"
        >
          ì±„íŒ…í•˜ê¸°
        </button>
        {% else %}
        <!-- ì§€ì›í•˜ì§€ ì•Šì€ ê³µê³ ì¸ ê²½ìš° -->
        <button
          class="apply-btn"
          onclick="event.stopPropagation(); applyJob({{ job.id }})"
        >
          ì§€ì›í•˜ê¸°
        </button>
        {% endif %}

        <div
          class="job-stats"
          style="
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
          "
        >
          ì¡°íšŒ {{ job.view_count }} | ì°œ {{ job.bookmark_count }}
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="empty-state">
        <h3>ë“±ë¡ëœ ê³µê³ ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
        <p>ì²« ë²ˆì§¸ ê³µê³ ë¥¼ ë“±ë¡í•´ë³´ì„¸ìš”!</p>
      </div>
      {% endif %}
    </div>

    <!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
    <div class="bottom-nav">
      <a href="#" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <span>ì°¾ê¸°</span>
      </a>
      <a href="{{ url_for('jobs.bookmark_list') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          />
        </svg>
        <span>ì°œ</span>
      </a>
      <a href="{{ url_for('auth.main') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
        </svg>
        <span>í™ˆ</span>
      </a>
      <a href="{{ url_for('chat.chat_list') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"
          />
        </svg>
        <span>ì±„íŒ…</span>
      </a>
      <a href="{{ url_for('auth.profile') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
          />
        </svg>
        <span>ë‚´ì •ë³´</span>
      </a>
    </div>

    <script>
      function filterByRegion(region) {
        if (region) {
          window.location.href = `{{ url_for('jobs.job_list') }}?region=${region}`;
        } else {
          window.location.href = `{{ url_for('jobs.job_list') }}`;
        }
      }

      // ê³µê³  ì§€ì›í•˜ê¸° í•¨ìˆ˜
      async function applyJob(jobId) {
        if (
          !confirm(
            "ì´ ê³µê³ ì— ì§€ì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì§€ì›í•˜ë©´ ìë™ìœ¼ë¡œ ì±„íŒ…ë°©ì´ ìƒì„±ë©ë‹ˆë‹¤."
          )
        ) {
          return;
        }

        try {
          const response = await fetch(`/jobs/${jobId}/apply`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "",
            }),
          });

          const data = await response.json();

          if (data.success) {
            alert(data.message);

            // ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í• ì§€ ë¬»ê¸°
            if (data.chat_room_id && confirm("ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
              window.location.href = `/chat/${data.chat_room_id}`;
            } else {
              // í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨í•˜ì—¬ ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
              location.reload();
            }
          } else {
            alert(data.message || "ì§€ì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("ì§€ì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
      async function goToChat(jobId) {
        try {
          // í•´ë‹¹ ê³µê³ ì™€ ê´€ë ¨ëœ ì±„íŒ…ë°© ì°¾ê¸°
          const response = await fetch(`/chat/find-room/${jobId}`, {
            method: "GET",
          });

          const data = await response.json();

          if (data.success && data.room_id) {
            window.location.href = `/chat/${data.room_id}`;
          } else {
            alert("ì±„íŒ…ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("ì±„íŒ…ë°© ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
      }

      // ì •ë ¬ ë“œë¡­ë‹¤ìš´ í† ê¸€
      function toggleSortDropdown() {
        const dropdown = document.getElementById("sortDropdown");
        dropdown.classList.toggle("show");

        // ë‹¤ë¥¸ ê³³ í´ë¦­ ì‹œ ë“œë¡­ë‹¤ìš´ ë‹«ê¸°
        document.addEventListener("click", function (event) {
          if (!event.target.closest(".sort-btn")) {
            dropdown.classList.remove("show");
          }
        });
      }

      // ì •ë ¬ ìˆœì„œ ë³€ê²½
      function changeSortOrder(sortBy) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set("sort", sortBy);
        window.location.href = currentUrl.toString();
      }
    </script>
  </body>
</html>
