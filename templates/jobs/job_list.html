<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ÏÇ¨ÎûåÏù¥Ïùå - Íµ¨Ïù∏Í≥µÍ≥†</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f8f9fa;
        padding-bottom: 80px;
        max-width: 480px;
        margin: 0 auto;
        position: relative;
      }

      /* ÏÉÅÎã® Ìó§Îçî */
      .header {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .logo {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .logo-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #ffd700, #ffa500);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
      }

      .logo-text {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
      }

      .header-icons {
        display: flex;
        gap: 15px;
      }

      .icon-btn {
        width: 24px;
        height: 24px;
        cursor: pointer;
        color: #666;
      }

      /* ÌÉ≠ Î©îÎâ¥ */
      .tab-menu {
        background: white;
        padding: 15px 20px 0;
        display: flex;
        gap: 30px;
      }

      .tab-item {
        padding: 10px 0;
        color: #666;
        font-size: 16px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.3s;
        text-decoration: none;
      }

      .tab-item.active {
        color: #2c3e50;
        border-bottom-color: #3498db;
        font-weight: 600;
      }

      /* ÏßÄÏó≠ ÏÑ†ÌÉù */
      .location-selector {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        gap: 8px;
        color: #3498db;
        font-size: 14px;
      }

      .location-icon {
        width: 16px;
        height: 16px;
      }

      .sort-btn {
        background: #f0f0f0;
        border: 1px solid #ddd;
        padding: 8px 16px;
        border-radius: 4px;
        font-size: 14px;
        margin-left: auto;
        cursor: pointer;
        position: relative;
      }

      .sort-dropdown {
        position: absolute;
        top: 100%;
        right: 0;
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 100;
        min-width: 120px;
        display: none;
      }

      .sort-dropdown.show {
        display: block;
      }

      .sort-option {
        padding: 10px 15px;
        cursor: pointer;
        font-size: 14px;
        border-bottom: 1px solid #eee;
        transition: background 0.2s;
      }

      .sort-option:last-child {
        border-bottom: none;
      }

      .sort-option:hover {
        background: #f8f9fa;
      }

      .sort-option.active {
        background: #3498db;
        color: white;
      }

      /* Í∏ÄÏì∞Í∏∞ Î≤ÑÌäº */
      .write-section {
        background: #3498db;
        padding: 20px;
        margin: 0 20px;
        border-radius: 12px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-top: 20px;
        cursor: pointer;
        transition: background 0.3s, transform 0.2s;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
      }

      .write-section:hover {
        background: #2980b9;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
      }

      .write-text {
        font-size: 18px;
        font-weight: 600;
        color: white;
        margin-right: 10px;
      }

      .write-btn {
        background: rgba(255, 255, 255, 0.2);
        border: none;
        font-size: 20px;
        cursor: pointer;
        color: white;
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
      }

      .write-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }

      /* Í≥µÍ≥† Î¶¨Ïä§Ìä∏ */
      .job-list {
        padding: 20px;
      }

      .job-card {
        background: white;
        margin: 0 20px 15px;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #e9ecef;
        cursor: pointer;
        transition: transform 0.2s;
        position: relative;
      }

      .job-card:hover {
        transform: translateY(-2px);
      }

      .job-image {
        width: 80px;
        height: 80px;
        background: #ddd;
        border-radius: 8px;
        flex-shrink: 0;
      }

      .job-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
      }

      .company-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .company-logo {
        width: 40px;
        height: 40px;
        background: #e9ecef;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        color: #666;
      }

      .company-details h3 {
        font-size: 16px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 2px;
      }

      .deadline {
        font-size: 12px;
        color: #e74c3c;
      }

      .job-title {
        font-size: 18px;
        font-weight: 600;
        color: #2c3e50;
        margin-bottom: 8px;
      }

      .job-salary {
        font-size: 16px;
        color: #27ae60;
        font-weight: 600;
        margin-bottom: 12px;
      }

      .job-tags {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
      }

      .tag {
        background: #f8f9fa;
        color: #666;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }

      .apply-btn {
        background: #3498db;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        width: 100%;
        transition: background 0.3s;
      }

      .apply-btn:hover {
        background: #2980b9;
      }

      .job-stats {
        font-size: 12px;
        color: #666;
      }

      /* ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò */
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        background: white;
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: space-around;
        padding: 12px 0;
        z-index: 1000;
      }

      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        color: #666;
        text-decoration: none;
        font-size: 12px;
        transition: color 0.3s;
      }

      .nav-item.active {
        color: #3498db;
      }

      .nav-icon {
        width: 24px;
        height: 24px;
      }

      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: #666;
      }

      .empty-state h3 {
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <!-- ÏÉÅÎã® Ìó§Îçî -->
    <div class="header">
      <div class="logo">
        <div class="logo-icon">üòä</div>
        <div class="logo-text">Ïù¥Ïùå</div>
      </div>
      <div class="header-icons">
        <svg class="icon-btn" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"
          />
          <path
            d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"
          />
        </svg>
        <svg class="icon-btn" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
      </div>
    </div>

    <!-- ÌÉ≠ Î©îÎâ¥ -->
    <div class="tab-menu">
      <a href="{{ url_for('auth.main') }}" class="tab-item">ÎÇòÏùò Ïù¥Ïùå</a>
      <a href="#" class="tab-item">Í∏∞ÏóÖ Ïù¥Ïùå</a>
      <a href="{{ url_for('jobs.job_list') }}" class="tab-item active"
        >ÏÇ¨Îûå Ïù¥Ïùå</a
      >
    </div>

    <!-- ÏßÄÏó≠ ÏÑ†ÌÉù -->
    <div class="location-selector">
      <svg class="location-icon" fill="currentColor" viewBox="0 0 24 24">
        <path
          d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"
        />
      </svg>
      <span>Í≤ΩÏÉÅÏãú Ï°∞ÏòÅÎèô</span>
      <svg
        style="width: 12px; height: 12px"
        fill="currentColor"
        viewBox="0 0 24 24"
      >
        <path d="M7 10l5 5 5-5z" />
      </svg>
      <div class="sort-btn" onclick="toggleSortDropdown()">
        {% if current_sort == 'latest' %}ÏµúÏã†Ïàú {% elif current_sort ==
        'popular' %}Ïù∏Í∏∞Ïàú {% elif current_sort == 'views' %}Ï°∞ÌöåÏàú {% else
        %}ÏµúÏã†Ïàú{% endif %}
        <svg
          style="width: 12px; height: 12px; margin-left: 5px"
          fill="currentColor"
          viewBox="0 0 24 24"
        >
          <path d="M7 10l5 5 5-5z" />
        </svg>
        <div class="sort-dropdown" id="sortDropdown">
          <div
            class="sort-option {% if current_sort == 'latest' %}active{% endif %}"
            onclick="changeSortOrder('latest')"
          >
            ÏµúÏã†Ïàú
          </div>
          <div
            class="sort-option {% if current_sort == 'popular' %}active{% endif %}"
            onclick="changeSortOrder('popular')"
          >
            Ïù∏Í∏∞Ïàú
          </div>
          <div
            class="sort-option {% if current_sort == 'views' %}active{% endif %}"
            onclick="changeSortOrder('views')"
          >
            Ï°∞ÌöåÏàú
          </div>
        </div>
      </div>
    </div>

    <!-- Í∏ÄÏì∞Í∏∞ ÏÑπÏÖò -->
    <div
      class="write-section"
      onclick="location.href='{{ url_for('jobs.create_job') }}'"
    >
      <div class="write-text">ÏùºÏûêÎ¶¨ Í≥µÍ≥† ÏûëÏÑ±ÌïòÍ∏∞</div>
      <button class="write-btn">+</button>
    </div>

    <!-- Í≥µÍ≥† Î¶¨Ïä§Ìä∏ -->
    <div class="job-list">
      {% if jobs_with_status %} {% for job_data in jobs_with_status %} {% set
      job = job_data.job %} {% set status = job_data.application_status %}
      <div
        class="job-card"
        onclick="location.href='{{ url_for('jobs.job_detail', job_id=job.id) }}'"
      >
        <div class="job-header">
          <div class="company-info">
            <div class="company-logo">
              {{ job.company[0] if job.company else 'Îã¥' }}
            </div>
            <div class="company-details">
              <h3>{{ job.company }} Îã¥ÎãπÏûê</h3>
            </div>
          </div>
        </div>
        <div class="job-title">{{ job.title }}</div>
        <div class="job-salary">
          {% if job.salary %}{{ job.salary }}{% else %}Í∏âÏó¨ ÌòëÏùò{% endif %}
        </div>
        <div class="job-tags">
          {% if job.recruitment_type %}<span class="tag"
            >{{ job.recruitment_type }}</span
          >{% endif %} {% if job.work_period %}<span class="tag"
            >{{ job.work_period }}</span
          >{% endif %}
        </div>

        {% if current_user.id == job.author_id %}
        <!-- Î≥∏Ïù∏Ïù¥ ÏûëÏÑ±Ìïú Í≥µÍ≥†Ïù∏ Í≤ΩÏö∞ -->
        <button
          class="apply-btn"
          style="background: #6c757d; cursor: not-allowed"
          disabled
        >
          ÎÇ¥Í∞Ä ÏûëÏÑ±Ìïú Í≥µÍ≥†
        </button>
        {% elif status.applied %}
        <!-- Ïù¥ÎØ∏ ÏßÄÏõêÌïú Í≥µÍ≥†Ïù∏ Í≤ΩÏö∞ -->
        <button
          class="apply-btn"
          style="background: #28a745"
          onclick="event.stopPropagation(); goToChat({{ job.id }})"
        >
          Ï±ÑÌåÖÌïòÍ∏∞
        </button>
        {% else %}
        <!-- ÏßÄÏõêÌïòÏßÄ ÏïäÏùÄ Í≥µÍ≥†Ïù∏ Í≤ΩÏö∞ -->
        <button
          class="apply-btn"
          onclick="event.stopPropagation(); applyJob({{ job.id }})"
        >
          ÏßÄÏõêÌïòÍ∏∞
        </button>
        {% endif %}

        <div
          class="job-stats"
          style="
            margin-top: 10px;
            font-size: 12px;
            color: #666;
            text-align: center;
          "
        >
          Ï°∞Ìöå {{ job.view_count }} | Ï∞ú {{ job.bookmark_count }}
        </div>
      </div>
      {% endfor %} {% else %}
      <div class="empty-state">
        <h3>Îì±Î°ùÎêú Í≥µÍ≥†Í∞Ä ÏóÜÏäµÎãàÎã§</h3>
        <p>Ï≤´ Î≤àÏß∏ Í≥µÍ≥†Î•º Îì±Î°ùÌï¥Î≥¥ÏÑ∏Ïöî!</p>
      </div>
      {% endif %}
    </div>

    <!-- ÌïòÎã® ÎÑ§ÎπÑÍ≤åÏù¥ÏÖò -->
    <div class="bottom-nav">
      <a href="#" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"
          />
        </svg>
        <span>Ï∞æÍ∏∞</span>
      </a>
      <a href="{{ url_for('jobs.bookmark_list') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          />
        </svg>
        <span>Ï∞ú</span>
      </a>
      <a href="{{ url_for('auth.main') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
        </svg>
        <span>Ìôà</span>
      </a>
      <a href="{{ url_for('chat.chat_list') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M20 6h-2.18c.11-.31.18-.65.18-1a2.996 2.996 0 0 0-5.5-1.65l-.5.67-.5-.68C10.96 2.54 10.05 2 9 2 7.34 2 6 3.34 6 5c0 .35.07.69.18 1H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-5-2c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9 4c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1z"
          />
        </svg>
        <span>Ï±ÑÌåÖ</span>
      </a>
      <a href="{{ url_for('auth.profile') }}" class="nav-item">
        <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"
          />
        </svg>
        <span>ÎÇ¥Ï†ïÎ≥¥</span>
      </a>
    </div>

    <script>
      function filterByRegion(region) {
        if (region) {
          window.location.href = `{{ url_for('jobs.job_list') }}?region=${region}`;
        } else {
          window.location.href = `{{ url_for('jobs.job_list') }}`;
        }
      }

      // Í≥µÍ≥† ÏßÄÏõêÌïòÍ∏∞ Ìï®Ïàò
      async function applyJob(jobId) {
        if (
          !confirm(
            "Ïù¥ Í≥µÍ≥†Ïóê ÏßÄÏõêÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏßÄÏõêÌïòÎ©¥ ÏûêÎèôÏúºÎ°ú Ï±ÑÌåÖÎ∞©Ïù¥ ÏÉùÏÑ±Îê©ÎãàÎã§."
          )
        ) {
          return;
        }

        try {
          const response = await fetch(`/jobs/${jobId}/apply`, {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              message: "",
            }),
          });

          const data = await response.json();

          if (data.success) {
            alert(data.message);

            // Ï±ÑÌåÖÎ∞©ÏúºÎ°ú Ïù¥ÎèôÌï†ÏßÄ Î¨ªÍ∏∞
            if (data.chat_room_id && confirm("Ï±ÑÌåÖÎ∞©ÏúºÎ°ú Ïù¥ÎèôÌïòÏãúÍ≤†ÏäµÎãàÍπå?")) {
              window.location.href = `/chat/${data.chat_room_id}`;
            } else {
              // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÌïòÏó¨ Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
              location.reload();
            }
          } else {
            alert(data.message || "ÏßÄÏõê Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("ÏßÄÏõê Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
        }
      }

      // Ï±ÑÌåÖÎ∞©ÏúºÎ°ú Ïù¥ÎèôÌïòÎäî Ìï®Ïàò
      async function goToChat(jobId) {
        try {
          // Ìï¥Îãπ Í≥µÍ≥†ÏôÄ Í¥ÄÎ†®Îêú Ï±ÑÌåÖÎ∞© Ï∞æÍ∏∞
          const response = await fetch(`/chat/find-room/${jobId}`, {
            method: "GET",
          });

          const data = await response.json();

          if (data.success && data.room_id) {
            window.location.href = `/chat/${data.room_id}`;
          } else {
            alert("Ï±ÑÌåÖÎ∞©ÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("Ï±ÑÌåÖÎ∞© Ïù¥Îèô Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.");
        }
      }

      // Ï†ïÎ†¨ ÎìúÎ°≠Îã§Ïö¥ ÌÜ†Í∏Ä
      function toggleSortDropdown() {
        const dropdown = document.getElementById("sortDropdown");
        dropdown.classList.toggle("show");

        // Îã§Î•∏ Í≥≥ ÌÅ¥Î¶≠ Ïãú ÎìúÎ°≠Îã§Ïö¥ Îã´Í∏∞
        document.addEventListener("click", function (event) {
          if (!event.target.closest(".sort-btn")) {
            dropdown.classList.remove("show");
          }
        });
      }

      // Ï†ïÎ†¨ ÏàúÏÑú Î≥ÄÍ≤Ω
      function changeSortOrder(sortBy) {
        const currentUrl = new URL(window.location.href);
        currentUrl.searchParams.set("sort", sortBy);
        window.location.href = currentUrl.toString();
      }
    </script>
  </body>
</html>
