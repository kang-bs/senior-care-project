<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ job.title }} - ê¸°ì—…ì´ìŒ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f8f9fa;
        max-width: 480px;
        margin: 0 auto;
        padding-bottom: 80px;
      }

      /* í—¤ë” */
      .header {
        background: white;
        padding: 15px 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .back-btn {
        background: none;
        border: none;
        font-size: 18px;
        cursor: pointer;
        color: #333;
      }

      .header-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
      }

      .header-actions {
        display: flex;
        gap: 10px;
      }

      .action-btn {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: #666;
      }

      /* ë©”ì¸ ì»¨í…ì¸  */
      .job-detail {
        background: white;
        margin: 20px;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .job-header {
        border-bottom: 1px solid #eee;
        padding-bottom: 20px;
        margin-bottom: 20px;
        position: relative;
      }

      .company-badge {
        position: absolute;
        top: 0;
        right: 0;
        background: #e67e22;
        color: white;
        padding: 4px 12px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
      }

      .company-info {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 15px;
      }

      .company-logo {
        width: 60px;
        height: 60px;
        background: #e9ecef;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        color: #666;
      }

      .company-details h2 {
        font-size: 18px;
        color: #333;
        margin-bottom: 5px;
      }

      .company-name {
        font-size: 14px;
        color: #666;
      }

      .job-title {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
      }

      .job-meta {
        display: flex;
        gap: 15px;
        font-size: 14px;
        color: #666;
      }

      /* ìƒì„¸ ì •ë³´ ì„¹ì…˜ */
      .detail-section {
        margin-bottom: 25px;
      }

      .section-title {
        font-size: 16px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 10px;
        padding-bottom: 5px;
        border-bottom: 2px solid #e67e22;
      }

      .info-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 15px;
      }

      .info-item {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 6px;
      }

      .info-label {
        font-size: 12px;
        color: #666;
        margin-bottom: 5px;
      }

      .info-value {
        font-size: 14px;
        color: #333;
        font-weight: 500;
      }

      .salary-highlight {
        background: #e8f5e8;
        color: #27ae60;
        font-weight: bold;
        font-size: 18px;
      }

      /* ê·¼ë¬´ ìš”ì¼ */
      .work-days {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .day-badge {
        background: #e67e22;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
      }

      .day-badge.inactive {
        background: #e9ecef;
        color: #6c757d;
      }

      /* ì„¤ëª… */
      .description {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        line-height: 1.6;
        color: #333;
        white-space: pre-wrap;
      }

      /* í†µê³„ ì •ë³´ */
      .job-stats {
        display: flex;
        justify-content: space-around;
        background: #f8f9fa;
        padding: 15px;
        border-radius: 6px;
        margin-top: 20px;
      }

      .stat-item {
        text-align: center;
      }

      .stat-number {
        font-size: 18px;
        font-weight: bold;
        color: #e67e22;
      }

      .stat-label {
        font-size: 12px;
        color: #666;
        margin-top: 5px;
      }

      /* ì•¡ì…˜ ë²„íŠ¼ */
      .action-buttons {
        position: fixed;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 100%;
        max-width: 480px;
        background: white;
        padding: 15px 20px;
        box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
        display: flex;
        gap: 10px;
      }

      .btn-bookmark {
        background: #f8f9fa;
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 6px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-apply {
        flex: 1;
        background: #e67e22;
        color: white;
        border: none;
        padding: 15px;
        border-radius: 6px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
      }

      .btn-apply:hover {
        background: #d35400;
      }

      /* ì‘ì„±ì ì•¡ì…˜ */
      .author-actions {
        display: flex;
        gap: 10px;
        margin-top: 20px;
        padding-top: 20px;
        border-top: 1px solid #eee;
      }

      .btn-edit,
      .btn-delete {
        flex: 1;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        cursor: pointer;
        text-align: center;
        text-decoration: none;
        font-size: 14px;
      }

      .btn-edit {
        background: #f8f9fa;
        color: #333;
      }

      .btn-delete {
        background: #dc3545;
        color: white;
        border-color: #dc3545;
      }

      .btn-applications {
        background: #e67e22;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        display: inline-block;
        margin-bottom: 10px;
      }

      .created-date {
        font-size: 12px;
        color: #999;
        text-align: right;
        margin-top: 15px;
      }

      .applications-summary {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 6px;
        padding: 15px;
        margin-top: 20px;
      }

      .applications-summary h4 {
        color: #856404;
        margin-bottom: 10px;
      }

      .applications-summary p {
        color: #856404;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <!-- í—¤ë” -->
    <div class="header">
      <button class="back-btn" onclick="history.back()">â†</button>
      <div class="header-title">ê¸°ì—… ê³µê³  ìƒì„¸</div>
      <div class="header-actions">
        <button class="action-btn">â‹¯</button>
      </div>
    </div>

    <!-- ê³µê³  ìƒì„¸ ì •ë³´ -->
    <div class="job-detail">
      <!-- í—¤ë” ì •ë³´ -->
      <div class="job-header">
        <div class="company-badge">ê¸°ì—…</div>
        <div class="company-info">
          <div class="company-logo">
            {{ job.company[0] if job.company else 'ê¸°' }}
          </div>
          <div class="company-details">
            <h2>{{ job.company }}</h2>
            <div class="company-name">ê¸°ì—… íšŒì›</div>
          </div>
        </div>
        <div class="job-title">{{ job.title }}</div>
        <div class="job-meta">
          <span>ì¡°íšŒ {{ job.view_count }}</span>
          <span>ì°œ {{ job.bookmark_count }}</span>
          <span>ì§€ì› {{ job.application_count }}</span>
        </div>
      </div>

      <!-- ê¸°ë³¸ ì •ë³´ -->
      <div class="detail-section">
        <div class="section-title">ê¸°ë³¸ ì •ë³´</div>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">ëª¨ì§‘ í˜•íƒœ</div>
            <div class="info-value">
              {{ job.recruitment_type or 'ë¯¸ì •' }} {% if job.recruitment_type ==
              'ì¼ìš©ì§' and job.work_period %}
              <span
                style="
                  margin-left: 8px;
                  padding: 2px 8px;
                  background: #e8f5e8;
                  color: #27ae60;
                  border-radius: 12px;
                  font-size: 12px;
                "
                >{{ job.work_period }}</span
              >
              {% endif %}
            </div>
          </div>
          <div class="info-item {% if job.salary %}salary-highlight{% endif %}">
            <div class="info-label">ê¸‰ì—¬</div>
            <div class="info-value">{{ job.salary or 'í˜‘ì˜' }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">ëª¨ì§‘ ì¸ì›</div>
            <div class="info-value">
              {{ job.recruitment_count or 'ë¯¸ì •' }}ëª…
            </div>
          </div>
          <div class="info-item">
            <div class="info-label">ê·¼ë¬´ ì§€ì—­</div>
            <div class="info-value">{{ job.region or 'í˜‘ì˜' }}</div>
          </div>
        </div>
      </div>

      <!-- ê·¼ë¬´ ì¡°ê±´ -->
      <div class="detail-section">
        <div class="section-title">ê·¼ë¬´ ì¡°ê±´</div>

        {% if job.work_start_time or job.work_end_time %}
        <div class="info-item" style="margin-bottom: 15px">
          <div class="info-label">ê·¼ë¬´ ì‹œê°„</div>
          <div class="info-value">
            {% if job.work_start_time %}{{ job.work_start_time.strftime('%H:%M')
            }}{% else %}ì‹œì‘ì‹œê°„ ë¯¸ì •{% endif %} ~ {% if job.work_end_time %}{{
            job.work_end_time.strftime('%H:%M') }}{% else %}ì¢…ë£Œì‹œê°„ ë¯¸ì •{%
            endif %}
          </div>
        </div>
        {% endif %}

        <div class="info-item">
          <div class="info-label">ê·¼ë¬´ ìš”ì¼</div>
          <div class="work-days">
            <span
              class="day-badge {% if not job.work_monday %}inactive{% endif %}"
              >ì›”</span
            >
            <span
              class="day-badge {% if not job.work_tuesday %}inactive{% endif %}"
              >í™”</span
            >
            <span
              class="day-badge {% if not job.work_wednesday %}inactive{% endif %}"
              >ìˆ˜</span
            >
            <span
              class="day-badge {% if not job.work_thursday %}inactive{% endif %}"
              >ëª©</span
            >
            <span
              class="day-badge {% if not job.work_friday %}inactive{% endif %}"
              >ê¸ˆ</span
            >
            <span
              class="day-badge {% if not job.work_saturday %}inactive{% endif %}"
              >í† </span
            >
            <span
              class="day-badge {% if not job.work_sunday %}inactive{% endif %}"
              >ì¼</span
            >
          </div>
        </div>
      </div>

      <!-- ìƒì„¸ ì„¤ëª… -->
      <div class="detail-section">
        <div class="section-title">ìƒì„¸ ì„¤ëª…</div>
        <div class="description">{{ job.description }}</div>
      </div>

      <!-- ì—°ë½ì²˜ -->
      {% if job.contact_phone %}
      <div class="detail-section">
        <div class="section-title">ì—°ë½ì²˜</div>
        <div class="info-item">
          <div class="info-label">ì „í™”ë²ˆí˜¸</div>
          <div class="info-value">{{ job.contact_phone }}</div>
        </div>
      </div>
      {% endif %}

      <!-- í†µê³„ -->
      <div class="job-stats">
        <div class="stat-item">
          <div class="stat-number">{{ job.view_count }}</div>
          <div class="stat-label">ì¡°íšŒìˆ˜</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ job.bookmark_count }}</div>
          <div class="stat-label">ì°œ</div>
        </div>
        <div class="stat-item">
          <div class="stat-number">{{ job.application_count }}</div>
          <div class="stat-label">ì§€ì›</div>
        </div>
      </div>

      <!-- ì‘ì„±ì ì „ìš© ì•¡ì…˜ -->
      {% if current_user.id == job.author_id %}
      <div class="applications-summary">
        <h4>ğŸ“‹ ì§€ì›ì ê´€ë¦¬</h4>
        <p>í˜„ì¬ {{ job.application_count }}ëª…ì´ ì§€ì›í–ˆìŠµë‹ˆë‹¤.</p>
        <a
          href="{{ url_for('company.company_job_applications', job_id=job.id) }}"
          class="btn-applications"
        >
          ì§€ì›ì ëª©ë¡ ë³´ê¸°
        </a>
      </div>

      <div class="author-actions">
        <a href="{{ url_for('jobs.edit_job', job_id=job.id) }}" class="btn-edit"
          >ìˆ˜ì •í•˜ê¸°</a
        >
        <form
          method="POST"
          action="{{ url_for('jobs.delete_job', job_id=job.id) }}"
          style="flex: 1"
          onsubmit="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')"
        >
          <button
            type="submit"
            class="btn-delete"
            style="width: 100%; border: none"
          >
            ì‚­ì œí•˜ê¸°
          </button>
        </form>
      </div>
      {% endif %}

      <div class="created-date">
        {{ job.created_at.strftime('%Yë…„ %mì›” %dì¼ %H:%M') }} ë“±ë¡
      </div>
    </div>

    <!-- ì•¡ì…˜ ë²„íŠ¼ (ì¼ë°˜ ì‚¬ìš©ìë§Œ) -->
    {% if current_user.user_type == 0 %}
    <div class="action-buttons">
      <button
        class="btn-bookmark"
        onclick="toggleBookmark()"
        style="color: {% if is_bookmarked %}#e74c3c{% else %}#666{% endif %};"
      >
        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"
          />
        </svg>
      </button>
      {% if application_status.applied %}
      <button
        class="btn-apply"
        style="background: #28a745"
        onclick="goToChatFromDetail()"
      >
        ì±„íŒ…í•˜ê¸°
      </button>
      {% else %}
      <button class="btn-apply" onclick="applyJob()">ì§€ì›í•˜ê¸°</button>
      {% endif %}
    </div>
    {% endif %}

    <script>
      function toggleBookmark() {
        const bookmarkBtn = document.querySelector('.btn-bookmark');
        const jobId = {{ job.id }};

        fetch(`/jobs/${jobId}/bookmark`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            if (data.is_bookmarked) {
              bookmarkBtn.style.color = '#e74c3c';
            } else {
              bookmarkBtn.style.color = '#666';
            }

            // í†µê³„ ì—…ë°ì´íŠ¸
            const bookmarkStat = document.querySelector('.stat-item:nth-child(2) .stat-number');
            if (bookmarkStat) {
              bookmarkStat.textContent = data.bookmark_count;
            }
          } else {
            alert(data.message || 'ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          }
        })
        .catch(error => {
          console.error('Error:', error);
          alert('ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        });
      }

      async function applyJob() {
        if (!confirm("ì´ ê³µê³ ì— ì§€ì›í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì§€ì›í•˜ë©´ ìë™ìœ¼ë¡œ ì±„íŒ…ë°©ì´ ìƒì„±ë©ë‹ˆë‹¤.")) {
          return;
        }

        const applyBtn = document.querySelector('.btn-apply');
        const originalText = applyBtn.textContent;

        try {
          applyBtn.disabled = true;
          applyBtn.textContent = 'ì§€ì› ì¤‘...';

          const response = await fetch(`/jobs/{{ job.id }}/apply`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: ''
            })
          });

          const data = await response.json();

          if (data.success) {
            alert(data.message);

            // ì§€ì› í†µê³„ ì—…ë°ì´íŠ¸
            const applicationStat = document.querySelector('.stat-item:nth-child(3) .stat-number');
            if (applicationStat) {
              applicationStat.textContent = parseInt(applicationStat.textContent) + 1;
            }

            // ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í• ì§€ ë¬»ê¸°
            if (data.chat_room_id && confirm('ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
              window.location.href = `/chat/${data.chat_room_id}`;
            } else {
              // ì§€ì›í•˜ê¸° ë²„íŠ¼ì„ ì±„íŒ…í•˜ê¸° ë²„íŠ¼ìœ¼ë¡œ ë³€ê²½
              applyBtn.textContent = 'ì±„íŒ…í•˜ê¸°';
              applyBtn.style.background = '#28a745';
              applyBtn.onclick = function() {
                window.location.href = `/chat/${data.chat_room_id}`;
              };
            }
          } else {
            alert(data.message || 'ì§€ì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            applyBtn.disabled = false;
            applyBtn.textContent = originalText;
          }
        } catch (error) {
          console.error('Error:', error);
          alert('ì§€ì› ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
          applyBtn.disabled = false;
          applyBtn.textContent = originalText;
        }
      }

      // ì±„íŒ…ë°©ìœ¼ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜ (ìƒì„¸ í˜ì´ì§€ìš©)
      async function goToChatFromDetail() {
        try {
          const response = await fetch(`/chat/find-room/{{ job.id }}`, {
            method: 'GET'
          });

          const data = await response.json();

          if (data.success && data.room_id) {
            window.location.href = `/chat/${data.room_id}`;
          } else {
            alert('ì±„íŒ…ë°©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          }
        } catch (error) {
          console.error('Error:', error);
          alert('ì±„íŒ…ë°© ì´ë™ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
      }
    </script>
  </body>
</html>
