{% extends "base.html" %} {% block title %}채팅 - 사람이음{% endblock %} {%
block extra_css %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='css/chat.css') }}"
/>
{% endblock %} {% block content %}
<!-- 상단 헤더 -->
{% include 'components/header.html' %}

<!-- 채팅 목록 제목 -->
<div class="section-title">
  채팅 {% if unread_total > 0 %}
  <span
    style="
      background: #e74c3c;
      color: white;
      border-radius: 50%;
      padding: 2px 8px;
      font-size: 12px;
      margin-left: 10px;
    "
  >
    {{ unread_total }}
  </span>
  {% endif %}
</div>

<!-- 채팅 목록 -->
<div class="chat-list">
  {% if chat_rooms %} {% for chat_data in chat_rooms %}
  <div
    class="chat-item {% if chat_data.unread_count > 0 %}unread{% endif %}"
    onclick="goToChatRoom({{ chat_data.room.id }})"
  >
    {% if chat_data.unread_count > 0 %}
    <div class="chat-unread-badge">{{ chat_data.unread_count }}</div>
    {% endif %}

    <div class="chat-header">
      <div class="chat-user-info">
        <div class="chat-avatar">
          {{ chat_data.other_user.nickname[0] if chat_data.other_user.nickname
          else '?' }}
        </div>
        <div>
          <div class="chat-user-name">{{ chat_data.other_user.nickname }}</div>
          <div class="chat-job-title">{{ chat_data.room.job.title }}</div>
        </div>
      </div>
      <div class="chat-time">
        {% if chat_data.last_message %} {{
        chat_data.last_message.created_at|time_ago }} {% else %} {{
        chat_data.room.created_at|time_ago }} {% endif %}
      </div>
    </div>

    <div class="chat-last-message">
      {% if chat_data.last_message %} {% if chat_data.last_message.message_type
      == 'system' %}
      <em>{{ chat_data.last_message.message }}</em>
      {% else %} {{ chat_data.last_message.message }} {% endif %} {% else %}
      채팅을 시작해보세요! {% endif %}
    </div>
  </div>
  {% endfor %} {% else %}
  <div class="chat-empty-state">
    <h3>채팅 내역이 없습니다</h3>
    <p>
      공고에 지원하면 자동으로 채팅방이 생성됩니다.<br />
      관심있는 공고에 지원해보세요!
    </p>
    <a href="{{ url_for('jobs.job_list') }}" class="btn-primary"
      >공고 둘러보기</a
    >
  </div>
  {% endif %}
</div>

<!-- 하단 네비게이션 -->
{% include 'components/bottom_nav.html' %} {% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='js/chat.js') }}"></script>
{% endblock %}
